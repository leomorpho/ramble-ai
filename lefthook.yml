# Lefthook configuration for RambleAI
# https://github.com/evilmartians/lefthook

# Global configuration
output:
  - execution
  - execution_out
  - execution_info
  - summary

# Pre-commit hooks
pre-commit:
  parallel: false
  commands:
    # Only run tests if relevant files changed
    tests:
      run: |
        # Check if Go files changed OR if pb-be submodule changed
        if git diff --cached --name-only | grep -q "\\.go$" || git diff --cached --name-only | grep -q "^pb-be$"; then
          echo "ðŸ§ª Running Go tests..."
          cd pb-be/pb && go test ./... -short -timeout=30s || exit 1
        fi
        if git diff --cached --name-only | grep -q "^frontend/"; then
          echo "ðŸ§ª Running Frontend tests..."
          cd frontend && npm run test:run || exit 1
        fi
      fail_text: "Tests failed"
      skip:
        - merge
        - rebase

# Pre-push hooks
pre-push:
  parallel: false
  commands:
    # Full test suite before push
    full-frontend-tests:
      root: "frontend/"
      run: npm run test:run
      fail_text: "Full frontend test suite failed"
      
    full-go-tests:
      root: "pb-be/pb/"
      run: go test ./... -short -timeout=60s
      fail_text: "Full Go test suite failed"

# Commit message hooks - DISABLED
# commit-msg:
#   commands:
#     # Check commit message format
#     commit-check:
#       run: |
#         if ! grep -qE '^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,50}' "{1}"; then
#           echo "Invalid commit message format."
#           echo "Use: type(scope): description"
#           echo "Types: feat, fix, docs, style, refactor, test, chore"
#           exit 1
#         fi
#       fail_text: "Commit message format is invalid"
#       skip:
#         - merge
#         - rebase